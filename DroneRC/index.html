<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" />-->
    <meta name="viewport" content=" user-scalable=0;" />
	
	<!-- Run in full-screen mode. -->
	<meta name="apple-mobile-web-app-capable" content="yes" />

	<!-- Make the status bar default. -->
	<meta name="apple-mobile-web-app-status-bar-style" content="default" />

	<!-- Customize home screen title. -->
	<meta name="apple-mobile-web-app-title" content="UniDro" />

    <!--Web App Logo-->
    <link href="data:image/png;base64,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" rel="apple-touch-icon" />

    <style type="text/css">
        * {
            font-size: 45px;
        }

        input, select {
            margin: 10px;
            width: 98%;
            height: 80px;
        }

        #connectBtn {
            width: 460px;
        }

        #levelModeBtn {
            margin-left:15px;
            width: 170px;
        }

        input[type=range]{
            width: 510px;
            height: 150px;
            -webkit-appearance: none;
        }

        #Aux3 {
            margin-top:194px;
            margin-left:-170px;
            -webkit-transform: rotate(270deg);
        }

        #Aux4 {
            width: 400px;
            float:right;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 300px;
            height: 15px;
            background: #ddd;
            border: none;
            border-radius: 3px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            border: none;
            height: 106px;
            width: 106px;
            border-radius: 50%;
            background: goldenrod;
            margin-top: -47px;
        }

        input[type=range]:focus {
            outline: none;
        }

        input[type=range]:focus::-webkit-slider-runnable-track {
            background: #ccc;
        }

        #GeoHCBtn, #RCHCBtn {
            height:62px;
            width: 54px;
            margin:0 8px;
            vertical-align:-16px;
        }

        #HFADJBtn {
            height: 62px;
            width: 190px;
            font-size:38px;
            margin:0 7px 0 23px;
        }

        td {
            padding: 0;
        }
    </style>

    <title>UniDro</title>
</head>
<body style="overflow:hidden;">
    <div style="float:left; width:250px;">
        <input type="range" id="Aux3" min="1000" max="2000" value="1000" disabled="disabled" />
    </div>
    <div style="float:left;">
        <input id="connectBtn" type="button" value="Connect" onclick="connect();"/><input id="levelModeBtn" type="button" value="ANG"/><br />
        <table style="width:100%;margin-top:7px;">
            <tr style="width:100%;">
                <td  style="width:36%;">
                    <input id="GeoHCBtn" type="checkbox" disabled="disabled" onclick="flagGeoHC = this.checked; if (!this.checked) { document.getElementById('RCHCBtn').checked = false; flagRCHC = false;}"/>GeoHF
                </td>
                <td style="width:31%;">
                    <input id="RCHCBtn" type="checkbox" disabled="disabled" onclick="flagRCHC = this.checked; if (this.checked) { document.getElementById('GeoHCBtn').checked = true; flagGeoHC = true; RCHCDegree = 'init';}"/>RCHF
                </td>
                <td style="width:36%;">
                    <input id="HFADJBtn" type="button" value="HF-ADJ" disabled="disabled" onclick=""/>
                </td>
            </tr>
        </table>

        <div id="consoleDiv" style="padding-left:10px;margin-top:7px;">Welcome to UniDro!</div>
        <div style="width:675px;">
            <input type="range" id="Aux4" min="1000" max="2000" value="1500" disabled="disabled" onmouseup="this.value=1500;" ontouchend="this.value=1500;"/>
        </div>
    </div>
    <div style="float:right;">
    </div>

    <script type="text/javascript">
        function write(str) {
            document.getElementById("consoleDiv").innerHTML = str;
        }

        var wsServer = "ws://192.168.4.1:81";
        var websocket;

        var connectionStatus = false;
        var motorStatus = false;

        var delay = 80;
        var disarmTimerTotal = Math.ceil(1000 / delay);
        var disarmTimerCurrent = 0;

        var RCAux1 = 1500;
        var RCAux2 = 1500;

        var Aux1Aux2Threadhold = 45;

        var flagGeoHC = false;
        var flagRCHC = false;

        var RCHCDegree = "init";
        var alpha = 0;
        var deltaAlpha = 0;

        var clkOrDblClkTimerId = null;
        var levelMode = 'ANG';

        function disarmAndDisconnect() {
            if (disarmTimerCurrent > disarmTimerTotal) {
                websocket.close();
                disarmTimerCurrent = 0;
            }
            else {
                websocket.send("1500,1500,1000,1000,1000,1000,1000,1000");
                disarmTimerCurrent++;

                setTimeout(disarmAndDisconnect, delay);
            }
        }
        
        function connect() {
            document.getElementById("Aux3").value = 0;
            document.getElementById("Aux4").value = 1500;
            if (connectionStatus) {
                connectionStatus = false;
                motorStatus = false;
                flagGeoHC = false;
                flagRCHC = false;

                document.getElementById("connectBtn").value = "Disconnecting ...";

                disarmTimerCurrent = 0;
                disarmAndDisconnect();
            }
            else {
                websocket = new WebSocket(wsServer);
                websocket.onopen = function (evt) { onOpen(evt) };
                websocket.onclose = function (evt) { onClose(evt) };
                websocket.onmessage = function (evt) { onMessage(evt) };
                websocket.onerror = function (evt) { onError(evt) };

                document.getElementById("connectBtn").value = "Connecting ...";
            }
        }

        function onOpen(evt) {
            connectionStatus = true;
            motorStatus = true;
            levelMode = 'ANG';
            document.getElementById("connectBtn").value = "Disconnect";
            document.getElementById("Aux3").disabled = "";
            document.getElementById("Aux4").disabled = "";
            document.getElementById("GeoHCBtn").disabled = "";
            document.getElementById("RCHCBtn").disabled = "";
            document.getElementById("levelModeBtn").disabled = "";
            write("Connected to WebSocket server.");
        }

        function onClose(evt) {
            connectionStatus = false;
            motorStatus = false;
            flagGeoHC = false;
            flagRCHC = false;
            document.getElementById("Aux3").disabled = "disabled";
            document.getElementById("Aux4").disabled = "disabled";
            document.getElementById("levelModeBtn").disabled = "disabled";
            document.getElementById("HFADJBtn").disabled = "disabled";
            document.getElementById("GeoHCBtn").disabled = "disabled";
            document.getElementById("RCHCBtn").disabled = "disabled";
            document.getElementById("GeoHCBtn").checked = false;
            document.getElementById("RCHCBtn").checked = false;
            document.getElementById("connectBtn").value = "Connect";
            write("Disconnected");
        }

        function onMessage(evt) {
            write("Retrieved data from server: " + evt.data);
        }

        function onError(evt) {
            write("Error occured: " + evt.data);
        }

        function mapping(iVal) {
            return Math.round(Math.max(Math.min(iVal, Aux1Aux2Threadhold), -Aux1Aux2Threadhold) / Aux1Aux2Threadhold * 500) + 1500;
        }

        function getRadByDeg(iDeg) {
            return (Math.PI * iDeg / 180);
        }


        document.getElementById("levelModeBtn").onclick = function (e) {
            if (!clkOrDblClkTimerId) {
                clkOrDblClkTimerId = setTimeout(function () {
                    clkOrDblClkTimerId = null;
                    
                    if (levelMode == "ANG") {
                        levelMode = "ACC";
                    }
                    else {
                        levelMode = "ANG";
                    }

                    document.getElementById("levelModeBtn").value = levelMode;
                }, 350);
            } else {
                clearTimeout(clkOrDblClkTimerId);
                clkOrDblClkTimerId = null;
                alert('Double');
            }
            e.preventDefault();
        };

        if (window.DeviceMotionEvent == undefined) {
            write("Sorry, your device does not support the device motion feature!");
        }
        else {
            window.ondeviceorientation = function (event) {
                if (flagRCHC) {
                    alpha = event.alpha;

                    if (RCHCDegree == "init") {
                        RCHCDegree = alpha;
                    }

                    deltaAlpha = getRadByDeg(RCHCDegree - alpha);

                    RCAux1 = mapping(Math.sin(deltaAlpha) * event.gamma + Math.cos(deltaAlpha) * event.beta);
                    RCAux2 = mapping(Math.cos(deltaAlpha) * event.gamma - Math.sin(deltaAlpha) * event.beta);
                }
                else {
                    RCAux1 = mapping(event.beta);
                    RCAux2 = mapping(event.gamma);
                }
            }
        }

        setInterval(function () {
            if (connectionStatus && motorStatus) {
                websocket.send(RCAux1 + "," + RCAux2 + "," + document.getElementById("Aux4").value + "," + document.getElementById("Aux3").value + "," + (levelMode == "ANG" ? 1000 : (levelMode == "HOR" ? 1500 : 2000)) + "," + (flagGeoHC ? 2000 : 1000) + ",1000,1000");
            }
        }, delay);

    </script>
</body>
</html>